{% extends 'app.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block main_content %}

    <div class="page-content">
        <div class="container-fluid">

            {{ include('partials/page-title.html.twig', {pagetitle: 'page_title.media_archive'|trans, title: 'page_title.media'|trans}) }}

            <div class="row" id="files-list">

                <div class="card">
                    <div class="card-body">
                        <!-- Upload Button Section -->
                        <div class="d-flex align-items-center mb-4">
                            <h5 class="card-title flex-grow-1 mb-0">{{ 'card_title.media'|trans }}</h5>
                            <div class="flex-shrink-0">
                                <!-- Hidden File Input -->
                                <input class="form-control d-none" type="file" id="mediaFile" data-id="{{ currentUser.id }}">
                                <!-- Custom Upload Button -->
                                <button type="button" class="btn btn-danger" id="uploadFileButton" data-upload-url="{{ path('media_files_upload') }}">
                                    <i class="ri-upload-2-fill me-1 align-bottom"></i> {{ 'button.upload_file'|trans }}
                                </button>
                            </div>
                        </div>

                        {% set fileTypeMapping = {
                            'pdf': { 'icon': 'ri-file-pdf-fill', 'color': 'text-secondary', 'bg': 'bg-secondary-subtle' },
                            'doc': { 'icon': 'ri-file-word-fill', 'color': 'text-primary', 'bg': 'bg-primary-subtle' },
                            'docx': { 'icon': 'ri-file-word-fill', 'color': 'text-primary', 'bg': 'bg-primary-subtle' },
                            'txt': { 'icon': 'ri-file-text-fill', 'color': 'text-danger', 'bg': 'bg-danger-subtle' },
                            'xlsx': { 'icon': 'ri-file-excel-fill', 'color': 'text-success', 'bg': 'bg-success-subtle' },
                            'jpg': { 'icon': 'ri-file-image-fill', 'color': 'text-warning', 'bg': 'bg-warning-subtle' },
                            'png': { 'icon': 'ri-file-image-fill', 'color': 'text-warning', 'bg': 'bg-warning-subtle' },
                        } %}

                        <!-- Documents Table -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <table class="table table-borderless align-middle mb-0">
                                        <thead class="table-light">
                                        <tr>
                                            <th scope="col">{{ 'label.file_name'|trans }}</th>
                                            <th scope="col">{{ 'label.type'|trans }}</th>
                                            <th scope="col">{{ 'label.size'|trans }}</th>
                                            <th scope="col">{{ 'label.upload_date'|trans }}</th>
                                            <th scope="col">{{ 'label.action'|trans }}</th>
                                        </tr>
                                        </thead>
                                        <tbody id="mediaTableBody">
                                        {% for file in files %}
                                            <tr id="fileRow-{{ file.id }}">
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-sm">
                                                            {% set normalizedFileType = file.fileType | lower %}
                                                            {% set mapping = fileTypeMapping[normalizedFileType] | default({'icon': 'ri-file-zip-fill', 'color': 'text-primary', 'bg': 'bg-primary-subtle'}) %}
                                                            {% set iconClass = mapping.icon %}
                                                            {% set colorClass = mapping.color %}
                                                            {% set bgClass = mapping.bg %}
                                                            <div class="avatar-title {{ bgClass }} {{ colorClass }} rounded fs-20 shadow">
                                                                <i class="{{ iconClass }}" aria-label="{{ file.fileType | upper }} file"></i>
                                                            </div>
                                                        </div>
                                                        <div class="ms-3 flex-grow-1">
                                                            <h6 class="fs-15 mb-0">
                                                                <a href="/media/uploads/{{ file.filePath }}" target="_blank">
                                                                    {{ file.fileName }}
                                                                </a>
                                                            </h6>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>{{ file.fileType }}</td>
                                                <td>{{ (file.fileSize / 1024)|number_format(2) }} KB</td>
                                                <td class="date">{{ file.created|date('Y-m-d H:i') }}</td>
                                                <td>
                                                    <div class="dropdown">
                                                        <a href="javascript:void(0);" class="btn btn-light btn-icon" id="dropdownMenuLink{{ file.id }}" data-bs-toggle="dropdown" aria-expanded="false" data-bs-boundary="viewport">
                                                            <i class="ri-equalizer-fill"></i>
                                                        </a>
                                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink{{ file.id }}">
                                                            <li><a class="dropdown-item" href="/media/uploads/{{ file.filePath }}" target="_blank"><i class="ri-eye-fill me-2 align-middle text-muted"></i>{{ 'link.view'|trans }}</a></li>
                                                            <li><a class="dropdown-item copy-link" href="javascript:void(0);" data-url="/media/uploads/{{ file.filePath }}"><i class="ri-file-copy-line me-2 align-middle text-muted"></i>Copy Link</a></li>
                                                            <li><a class="dropdown-item" href="/media/uploads/{{ file.filePath }}" download><i class="ri-download-2-fill me-2 align-middle text-muted"></i>{{ 'link.download'|trans }}</a></li>
                                                            <li class="dropdown-divider"></li>
                                                            <li>
                                                                <a class="dropdown-item delete-file" href="javascript:void(0);" data-id="{{ file.id }}" data-delete-url="{{ path('media_files_delete', {'id': file.id}) }}">
                                                                    <i class="ri-delete-bin-5-line me-2 align-middle text-muted"></i>{{ 'link.delete'|trans }}
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% else %}
                                            <tr id="noFilesRow">
                                                <td colspan="5">{{ 'text.no_media_files_found'|trans }}</td>
                                            </tr>
                                        {% endfor %}
                                        <!-- Delete File Modal -->
                                        <div class="modal fade" id="deleteFileModal" tabindex="-1" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-body p-5 text-center">
                                                        <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json"
                                                                   trigger="loop"
                                                                   colors="primary:#405189,secondary:#f06548"
                                                                   style="width:90px;height:90px">
                                                        </lord-icon>
                                                        <div class="mt-4 text-center">
                                                            <h4>{{ 'text.delete_file_confirmation'|trans }}</h4>
                                                            <p class="text-muted fs-15 mb-4">{{ 'text.delete_file_warning'|trans }}</p>
                                                            <!-- Hidden inputs to store file ID and CSRF token -->
                                                            <input type="hidden" id="deleteFileId" value="">
                                                            <input type="hidden" id="csrfTokenDeleteFile" value="{{ csrf_token('delete_file') }}">
                                                            <div class="hstack gap-2 justify-content-center remove">
                                                                <button type="button" class="btn btn-link link-success fw-medium text-decoration-none" data-bs-dismiss="modal">
                                                                    <i class="ri-close-line me-1 align-middle"></i> {{ 'button.close'|trans }}
                                                                </button>
                                                                <button class="btn btn-danger" id="confirmDeleteFileBtn" type="button">{{ 'button.delete'|trans }}</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--end modal -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!--end row-->
                    </div>
                </div>

            </div><!--end row-->

        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

{% endblock %}

{% block javascripts %}

    <!-- profile init js -->
    <script src="{{ asset('assets/js/pages/file-upload.init.js') }}"></script>

    {{ parent() }}
{% endblock %}
